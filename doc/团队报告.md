# 软件工程大作业 小组团队报告

---

## 小组成员：

熊彦钧（23336266）、吴深荣（23336252）、罗斯（22361063）、李锐钊（22361058）

## 软件项目：

基于IDM-VTON框架的虚拟试穿系统

## 主要工作概要：

（1）修改源代码，将IDM-VTON成功部署到服务器上；

（2）分析IDM-VTON框架的运行逻辑，并编写一份文档进行说明；

（3）修改框架源码，拓展webUI的功能；

（4）重写前端代码，覆盖掉功能较差的Gradio前端；

（5）在服务器和本地上分别部署数据库，存储用户信息以及图片数据；

（6）开发浏览器插件，作为系统拓展功能的辅助插件；

（7）用端口转发和调用API的方法将webUI暴露到本地，使得服务器框架对用户透明；

## 工作完成状况：

##### （1）修改源代码，将IDM-VTON成功部署到服务器上：                  已完成

    IDM-VTON是2021年公布的项目，由于这几年huggingface和Gradio等依赖因版本更新导致的代码变化，IDM-VTON源码以及官网上的教程均出现了偏差。具体表现为新版本的huggingface hub无法运行IDM-VTON官网上预训练好的模型，但是旧版的huggingface又和Gradio依赖产生冲突。因此，我们给源码的huggingface添加了兼容性补丁。添加补丁后的框架代码保存在了熊彦钧同学的GitHub上面：[https://github.com/jh1nx/IDM-VTON](https://github.com/jh1nx/IDM-VTON)

    通过这个补丁，并根据源码的environment.yaml文件，我们可以比较简单地将IDM-VTON框架部署到服务器上。

##### （2）分析IDM-VTON框架的运行逻辑，并编写一份文档进行说明：               已完成

    由于IDM-VTON框架本身十分庞大，并且项目初期我们对如何修改它无从下手，因此我们借助AI分析了IDM-VTON中各个文件的作用，理解虚拟试穿的流程。

    最终的分析结果保存在了“框架分析实录.md”中，详细结果请见文档。

##### （3）修改框架源码，拓展webUI的功能：                  已完成

    我们尝试运行IDM-VTON框架中的/gradio_demo/app.py文件后发现，框架原有的webUI实在是太过简陋，并且功能过于简单。因此，在项目初期，我们在原有的代码上进行了修改，增加了分页式导航，添加了数据库接口以支撑注册登录功能，并且为每个用户预留好了接口可以浏览用户上传文件的目标文件夹，以及用户保存试穿结果的目标路径。我们做这些的主要思路是：把这个虚拟试穿框架开发成一个应用，把这个框架部署到服务器后，用户就可以在各种的主机上运行应用，并且通过注册登录获取独立的数据存储空间，以保护用户个人隐私；而为了避免用户每次试穿都需要反复地上传个人的人像图片，我们为每个注册的用户提供一个路径保存用户上传的图片，这样就无需反复上传图片了。并且我们在云端进行数据库的同步，以支撑用户在不同的设备上进行使用。

    这一部分的修改主要集中在IDM-VTON/gradio_demo/merged_new.py中，呈现的是经过多个版本修改、功能拓展后的最终成品。

    在项目后期，在Software_Engineering_AITryOn/local_client/app.py中也有部分关于功能上的修改，主要是重写了图片批量管理系统，并增加了“使用教程”页面。

##### （4）重写前端代码，覆盖掉功能较差的Gradio前端：                已完成

    在项目前期，我们使用的是IDM-VTON框架所沿用的Gradio来进行webUI的开发，但是在开发过程中我们发现Gradio能支撑的功能十分有限，无法满足我们对现代化webUI的需求。因此在项目后期，我们使用JavaScript重写了webUI，并通过端口转发和API调用的方法，沿用任务（3）中已实现的功能拓展。最终实现了现代化webUI设计，并同时达到了IDM-VTON框架对用户完全透明的效果。

这一部分的修改集中在Software_Engineering_AITryOn/local_client/app.py和Software_Engineering_AITryOn/local_client/templates中。

##### （5）在服务器和本地上分别部署数据库，存储用户信息以及图片数据：                   已完成

    我们在试用IDM-VTON框架的时候发现，用户反复地上传某个特定的人像照片或衣服照片其实是十分麻烦的一件事情，因为用户需要像在Windows系统打开某一个文件一样，从文件资源管理器开始不断地寻找。因此我们在项目初期就决定植入数据库，为每个用户分配独立的存储空间，这样用户只需要预先上传好图片，在使用软件的时候分别浏览人像图片的保存路径和衣服图片的保存路径并直接选择就可以了，这样大大减少了用户反复检索和上传的时间。并且，如果用户喜欢、想要保存试穿结果，我们还增加了收藏功能，即为每个用户单独开辟一个保存试穿结果的目标路径，用户可以查看这个文件夹，并进行图片批量管理。

    与此同时，为了实现IDM-VTON框架对用户透明，我们在云端部署数据库的同时，还开发了一个本地数据库系统，用户需要在主机上下载本地数据库系统进行登录注册以及图片上传，我们通过端口转发实现云端数据库和本地数据库的同步。通过这样的操作，同一个账号的用户即使更换了登录设备，也能查看到自己同步到云端的图片。

服务器云端数据库的代码在user-auth-system中，而本地数据库的代码主要在local_client中。

##### （6）开发浏览器插件，作为系统拓展功能的辅助插件：               已完成

我们在项目初期体验框架的时候发现，如果用户在购物网站上面发现一件想要试穿的衣服，那么用户需要先截图，然后再在文件资源管理器上选中这张截图。每次反复地截图不仅浪费时间，试穿结束后还需要分别找到每张照片进行删除。因此我们开发了一个浏览器插件，它可以将浏览器任何网站上面的图片直接传输到本地数据库，本地数据库可以支持一键发送到云端，这样用户只需要一键浏览用户的文件夹即可选择图片进行试穿。

浏览器插件的代码在Software_Engineering_AITryOn/browser_extension中。

##### （7）用端口转发和调用API的方法将webUI暴露到本地，使得服务器框架对用户透明：                已完成

这是我们在软件开发后期增加的任务，前面已经提到了具体的目的和操作，这里就不再重复阐述了。

这一部分的代码集成在了Software_Engineering_AITryOn/local_client中，端口转发和API调用的具体代码在app.py里面。

##### （8）其他进展：

* 我们分别在本地和服务器上面编写了测试文件（Software_Engineering_AITryOn/local_client/test_api.py、Software_Engineering_AITryOn/local_client/test_server.py和IDM-VTON/test_tryon_api.py），对服务器的merged_new.py和本地的app.py进行了测试；
* 我们编写了本地数据库的部署教程和使用手册，浏览器插件的部署和使用教程、以及用户从下载好本地数据库开始到试穿完成的教程。

## 工作分配情况：

##### 熊彦钧：

（1）分析IDM-VTON的虚拟试穿执行过程，编写了"框架分析实录.md"；

（2）实现虚拟试穿系统的webUI功能扩展函数：即用户路径保存函数、文件夹浏览函数、图片选择函数、图片转码并收藏函数、图片库图片批量管理相关函数（包括IDM-VTON/gradio_demo/app.py中的功能拓展函数和Software_Engineering_AITryOn /local_client/app.py中的功能拓展函数）；

（3）编写文档：需求分析报告、系统建模报告、架构设计文档、软件工程化说明文档、软件配置与运维文档、虚拟试穿系统使用教程以及本文档；

（4）和吴深荣协作，实现前端webUI和前端拓展功能的拼接；

##### 吴深荣：

（1）实现虚拟试穿系统的webUI设计（包括IDM-VTON/gradio_demo/app.py里的webUI相关代码和Software_Engineering_AITryOn /local_client/templates中的webUI相关代码）；

（2）编写软件测试与质量保证报告；

（3）和熊彦钧协作，实现前端webUI和前端拓展功能的拼接；

##### 李锐钊：

（1）修改源代码，解决IDM-VTON的服务器部署问题；

（2）开发浏览器插件（Software_Engineering_AITryOn/broswer_extension）；

（3）开发本地数据库（Software_Engineering_AITryOn/local_client），实现用户在本地的注册、登录功能，并编写端口转发函数，实现本地调用服务器app.py中的功能函数；

（4）录制demo；

（5）和罗斯协作，实现本地数据库和服务器数据库的数据同步；

##### 罗斯：

（1）开发服务器数据库，存储用户登录注册信息，用户上传的图片、保存路径的独立分配、以及用户数据的同步。在用户登录时发送数据供本地客户端使用。

（2）和李锐钊协作，实现本地数据库和服务器数据库的数据同步；

附1：本小组与本次软件工程有关的修改代码、开发代码仓库：

[https://github.com/alittleplayyer/AITryOn](https://github.com/alittleplayyer/AITryOn)（修改后的IDM-VTON框架以及云端服务器代码）；

[https://github.com/jh1nx/Software_Engineering-AITryOn](https://github.com/jh1nx/Software_Engineering-AITryOn) （浏览器插件、本地数据库、本地运行的虚拟试穿系统代码、以及所需的各种文档）

附2：IDM-VTON虚拟试穿框架源码：

[https://github.com/yisol/IDM-VTON](https://github.com/yisol/IDM-VTON)
